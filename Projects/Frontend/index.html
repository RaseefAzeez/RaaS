<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RaaS Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            maroon: {
              DEFAULT: '#800000',
              700: '#800000'
            },
            'slate-light': '#f8fafc'
          }
        }
      }
    }
  </script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    crossorigin="anonymous" />

</head>

<body class="bg-slate-light font-sans text-gray-800">

  <!-- ================= HEADER ================= -->
  <header class="relative bg-maroon-700 pb-20">
    <div class="relative max-w-5xl mx-auto px-6 pt-10 pb-10 text-white flex justify-between">
      <h1 class="text-4xl font-awesome">
        RaaS <span class="text-xl text-maroon-100">(Reboot-as-a-Service)</span>
      </h1>
      <div id="auth-buttons"></div>
    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="-mt-24 max-w-5xl mx-auto px-6 pb-16">

    <!-- STATUS -->
    <div class="bg-white p-8 rounded-2xl shadow-xl mb-10">
      <h2 class="text-2xl font-semibold mb-6">EC2 Instance Status</h2>

      <button id="btn-status" class="px-8 py-3 bg-maroon-700 text-white rounded-xl font-bold">
        Retrieve Status
      </button>

      <pre id="status-output" class="mt-6 bg-gray-900 text-green-400 p-6 rounded-xl text-sm"></pre>
    </div>

    <!-- REBOOT Functionality -->
    <div class="bg-white p-8 rounded-2xl shadow-xl">
      <h2 class="text-2xl font-semibold mb-6">Reboot Instance</h2>

      <input id="instance-id" class="border px-4 py-3 rounded-lg w-full mb-4" placeholder="i-xxxxxxxxxxxx" />

      <button id="btn-reboot" class="px-8 py-3 bg-gray-700 text-white rounded-xl font-bold">
        Reboot
      </button>

      <pre id="reboot-output" class="mt-6 bg-gray-900 text-yellow-300 p-6 rounded-xl text-sm"></pre>
    </div>

  </main>

  <!-- ================= FOOTER ================= -->
  <footer class="mt-16 py-6 bg-black text-gray-400 text-center">
    © 2025 RaaS · Created by Raseef Azeez
  </footer>

  <!-- ================= AUTH CONFIG ================= -->
  <script>
    const COGNITO_DOMAIN = "https://us-east-1ddyxzzaiw.auth.us-east-1.amazoncognito.com";
    const CLIENT_ID = "5g8gugkm6cre8sjll45kjii9q6"; // NEW SPA CLIENT
    const REDIRECT_URI = "https://d1l62wn91r29l3.cloudfront.net/callback.html";
  </script>

  <!-- ================= PKCE + AUTH ================= -->
  <script>
    const authButtons = document.getElementById("auth-buttons");

    function base64UrlEncode(buffer) {
      return btoa(String.fromCharCode(...new Uint8Array(buffer)))
        .replace(/\+/g, "-")
        .replace(/\//g, "_")
        .replace(/=+$/, "");
    }

    async function sha256(plain) {
      const encoder = new TextEncoder();
      return await crypto.subtle.digest("SHA-256", encoder.encode(plain));
    }

    function generateVerifier() {
      const arr = new Uint8Array(32);
      crypto.getRandomValues(arr);
      return base64UrlEncode(arr);
    }

    async function login() {
      const verifier = generateVerifier();
      sessionStorage.setItem("pkce_verifier", verifier);

      const challenge = base64UrlEncode(await sha256(verifier));

      const loginUrl =
        `${COGNITO_DOMAIN}/oauth2/authorize` +
        `?client_id=${CLIENT_ID}` +
        `&response_type=code` +
        `&scope=openid+email+profile` +
        `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}` +
        `&code_challenge=${challenge}` +
        `&code_challenge_method=S256`;

      window.location.href = loginUrl;
    }

    function logout() {
      sessionStorage.clear();
      window.location.reload();
    }

    function renderAuthButtons() {
      const token = sessionStorage.getItem("access_token");

      authButtons.innerHTML = token
        ? `<button onclick="logout()" class="px-4 py-2 bg-gray-800 text-white rounded">Logout</button>`
        : `<button onclick="login()" class="px-4 py-2 bg-white text-maroon-700 rounded font-bold">Login</button>`;
    }

    renderAuthButtons();
  </script>

  <!-- ================= API CALLS ================= -->
  <script src="./getdetails.js"></script>

</body>

</html>